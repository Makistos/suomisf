{% extends "base.html" %}
{% block content %}
{% if current_user.is_admin %}
<form method="post" id="itemForm">
    {{ form.hidden_tag() }}
    {% endif %}
    <div class="container">
        <div class="card-body">
            <div class="row">
                <div class="col">
                    {% if current_user.is_admin %}
                    <h1 class="card-title edit-field">
                        <input type="text" class="form-control form-item" id="title" name="title"
                            value="{{edition.title}}" form="itemForm">
                    </h1>
                    {% endif %}
                    <h1 class="card-title view-field">
                        {{ edition.title }}
                    </h1>
                </div>
            </div>
            <div class="row">
                {% if current_user.is_admin %}
                <div class="col edit-field">
                    <label for="subtitle">Alaotsikko</label>
                    <input type="text" class="form-control form-item" id="subtitle" name="subtitle"
                        value="{{edition.subtitle if edition.subtitle is not none}}" form="itemForm">
                </div>
                {% endif %}
                <div class="col view-field">
                    {{subtitle}}
                </div>
            </div>
            <div class="row mb-3">
                <div class="col">
                    <h3>
                        {% if works|length > 1 or works[0].orig_title != edition.title %}
                        {% for work in works %}
                        <a href="{{url_for('work', workid=work.id)}}">{{work.orig_title}}</a><br>
                        {% endfor %}
                        {% endif %}
                    </h3>
                </div>
            </div>
            <div class="row">
                <!-- Image part-->
                <div class="col-lg-4 col-sm-12">
                    <div class="row">
                        <div class="col">
                            <!--<img src="/static/images/books/Aldiss_Kasvihuone.jpg"> -->
                            {% if edition.images|length %}
                            <img src="{{edition.images[0].image_src}}" class="img-fluid">
                            {% else %}
                            <img src="/static/icons/book-icon-158.png" class="img-fluid">
                            {% endif %}
                        </div>
                    </div>
                    {% if current_user.is_admin %}
                    <div class="row edit-field">
                        <div class="col">
                            <input type="file" class="form-control" name="image_upload" id="image_upload"
                                data-save="/save_image_to_edition">
                        </div>
                    </div>
                    {%endif %}
                    {% if edition.image_src %}
                    <div class="row edit-field">
                        <div class="col">
                            <a href="{{url_for('remove_image_from_edition', editionid=edition.id)}}">Poista kuva</a>
                        </div>
                    </div>
                    {% endif %}
                </div>

                <!-- Info part -->
                <div class="col-lg-8">
                    <!-- Authors -->
                    <h4>
                        <!-- No editing authors in edition -->
                        {% if editors|length == 0 %}
                        <span class="person-list">{{ authors|map(attribute='name')|join(', ') }}</span>
                        {% endif %}
                    </h4>
                    <!-- Editors -->
                    <div class="row">
                        {% if current_user.is_admin %}
                        <div class="col edit-field">
                            <label for="editors">Toimittajat</label>
                            <select class="form-control" multiple="multiple" data-placeholder="Toimittaja"
                                data-search="/select_person" data-save="/save_editors_to_edition"
                                data-init="/editors_for_edition" data-name="editors" name="editors">
                            </select>
                        </div>
                        {% endif %}
                        <div class="col view-field">
                            {% if editors|length %}
                            <span class="person-list">{{editors|map(attribute='alt_name')|join(', ')}}</span> (toim)
                            {% endif %}
                        </div>
                    </div>
                    <!-- Translators -->
                    <div class="row">
                        {% if current_user.is_admin %}
                        <div class="col edit-field">
                            <label for="translastors">Kääntäjät</label>
                            <select class="form-control" multiple="multiple" data-placeholder="Suomentaja"
                                data-search="/select_person" data-save="/save_translators_to_edition"
                                data-init="/translators_for_edition" data-name="translators" name="translators">
                            </select>
                        </div>
                        {% endif %}
                        <div class="col view-field">
                            {% if translators|length %}
                            <span class="person-list">{{translators|map(attribute='alt_name')|join(', ')}}</span>
                            (suom)
                            {% endif %}
                        </div>
                    </div>
                    <!-- Publisher -->
                    <div class="row">
                        {% if current_user.is_admin %}
                        <div class="col-6 edit-field">
                            <label for="publisher">Julkaisija</label>
                            <select class="form-control" data-placeholder="Julkaisija" data-search="/select_publisher"
                                data-save="/save_publisher_to_edition" data-init="/publisher_for_edition"
                                data-name="publisher" id="publisher" name="publisher">
                            </select>
                        </div>
                        <div class="col-2 edit-field">
                            <label for="pubyear">Vuosi</label>
                            <input type="text" class="form-control form-item"
                                value="{{edition.pubyear if edition.pubyear is not none}}" name="pubyear" id="pubyear">
                        </div>
                        <div class="col-2 edit-field">
                            <label for="editionnum">Painos</label>
                            <input type="text" class="form-control form-item"
                                value="{{edition.editionnum if edition.editionnum is not none}}" name="editionnum"
                                id="editionnum" style="width:50%;">
                        </div>
                        <div class="col-2 edit-field">
                            <label for="version">Laitos</label>
                            <input type="text" class="form-control form-item"
                                value="{{edition.version if edition.version is not none}}" name="version" id="version"
                                style="width:50%;">
                        </div>
                        {% endif %}
                        <div class="col view-field">
                            <a href="{{url_for('publisher', pubid=edition.publisher.id)}}">
                                {{ edition.publisher.name }}</a> {{ edition.pubyear }}.
                            {% if edition.version %}
                            {{edition.version}}. laitos
                            {% else %}
                            {{edition.editionnum}}.p
                            {% endif %}
                        </div>
                    </div>
                    <!-- Series -->
                    <div class="row">
                        {% if current_user.is_admin %}
                        <div class="col-10 edit-field">
                            <label for="pubseries">Julkaisijan sarja</label>
                            <select class="pubseries-selector form-control" data-placeholder="Sarja"
                                data-search="/select_pubseries" data-save="/save_pubseries_to_edition"
                                data-init="/pubseries_for_edition" data-name="pubseries" name="pubseries">
                            </select>
                        </div>
                        <div class="col-2 edit-field">
                            <label for="pubseriesnum">Nro</label>
                            <input type="text" class="form-control form-item"
                                value="{{edition.pubseriesnum if edition.pubseriesnum is not none}}" id="pubseriesnum"
                                name="pubseriesnum" style="width:50%;">
                        </div>
                        {% endif %}
                        <div class="col view-field">
                            {% if edition.pubseries %}
                            <a href="{{url_for('pubseries', seriesid=edition.pubseries.id)}}">
                                {{ edition.pubseries.name }}</a>
                            {% if edition.pubseriesnum %}
                            {{ edition.pubseriesnum }}
                            {%- endif -%}
                            .
                            {% endif %}
                        </div>
                    </div>
                    <!-- Format etc -->
                    <div class="row">
                        {% if current_user.is_admin %}
                        <div class="col-6 edit-field">
                            <label for="pages">
                                Sivuja
                                <input type="text" class="form-control form-item" id="pages" name="pages"
                                    value="{{edition.pages if edition.pages is not none}}">
                            </label>
                        </div>
                        {% endif %}
                        <div class="col view-field">
                            {% if edition.pages %}
                            {{ edition.pages}} sivua.
                            {% endif %}
                            {% if edition.size and edition.size_id != 1 %}
                            {{edition.size.name}} ({{edition.size.mm_height}}mm x {{edition.size.mm_width}}mm).
                            {% endif %}
                        </div>
                        {% if current_user.is_admin %}
                        <div class="col-6 edit-field">
                            <label for="size">Koko</label>
                            <select class="size-selector form-control" data-placeholder="Koko"
                                data-search="/select_size" data-save="/save_size_to_edition"
                                data-init="/size_for_edition" data-mininput="1" data-name="size" name="size"></select>
                        </div>
                        {% endif %}
                    </div>
                    <!-- Misc -->
                    <div class="row">
                        <div class="col">
                            {% if current_user.is_admin %}
                            <div class="edit-field">
                                <label for="misc">Muuta</label>
                                <input type="text" class="form-control form-item" id="misc" name="misc"
                                    value="{{edition.misc if edition.misc if not none}}">
                            </div>
                            {% endif %}
                            <div class="view-field">
                                {{edition.misc}}
                            </div>
                        </div>
                    </div>
                    <!-- ISBN -->
                    <div class="row">
                        {% if current_user.is_admin %}
                        <div class="col-3 edit-field">
                            <label fo="isbn">ISBN</label>
                            <div class="input-group">
                                <input type="text" class="form-control form-item" id="isbn" name="isbn"
                                    style="width:30;" value="{{edition.isbn if edition.isbn is not none}}">
                            </div>
                        </div>
                        {% endif %}
                        <div class="col view-field">
                            {% if edition.isbn %}
                            ISBN {{ edition.isbn}}
                            {%- endif -%}
                            {% if edition.binding %}
                            {{ edition.binding.name }}
                            {%- endif -%}
                            {%- if edition.isbn or edition.binding -%}
                            .
                            {% endif %}
                        </div>
                        {% if current_user.is_admin %}
                        <div class="col-3 edit-field">
                            <label>Sidonta</label>
                            <div class="custom-control custom-radio">
                                <input type="radio" name="binding" class="custom-control-input form-item"
                                    id="binding_none" value="1" {{bindings[1]}}>
                                <label class="custom-control-label" for="binding_none">
                                    Ei tietoa
                                </label>
                            </div>
                            <div class="custom-control custom-radio">
                                <input type="radio" name="binding" class="custom-control-input form-item" id="nidottu"
                                    value="2" {{bindings[2]}}>
                                <label class="custom-control-label" for="nidottu">
                                    Nidottu
                                </label>
                            </div>
                            <div class="custom-control custom-radio">
                                <input type="radio" name="binding" class="custom-control-input form-item" id="sidottu"
                                    value="3" {{bindings[3]}}>
                                <label class="custom-control-label" for="sidottu">
                                    Sidottu
                                </label>
                            </div>
                            {#
                            <select class="binding-selector form-control" data-placeholder="Sidonta" data-mininput="1"
                                data-name="bindingType"></select>
                            #}
                        </div>
                        <div class="col-3 edit-field">
                            <label>Ylivetokannet</label>
                            <div class="custom-control custom-radio">
                                <input type="radio" name="dustcover" class="custon-control-input form-item"
                                    id="dustcover_none" value="0" {{dustcovers[0]}}>
                                <label class="custom-contrl-label" for="dustcover_none">
                                    Ei tietoa
                                </label>
                            </div>
                            <div class="custom-control custom-radio">
                                <input type="radio" name="dustcover" class="custon-control-input form-item"
                                    id="dustcover_no" value="1" {{dustcovers[1]}}>
                                <label class="custom-contrl-label" for="dustcover_no">
                                    Ei
                                </label>
                            </div>
                            <div class="custom-control custom-radio">
                                <input type="radio" name="dustcover" class="custon-control-input form-item"
                                    id="dustcover_yes" value="2" {{dustcovers[2]}}>
                                <label class="custom-contrl-label" for="dustcover_yes">
                                    Kyllä
                                </label>
                            </div>
                        </div>
                        <div class="col-3 edit-field">
                            <label>Kuvakansi</label>
                            <div class="custom-control custom-radio">
                                <input type="radio" name="coverimage" class="custon-control-input form-item"
                                    id="coverimage_none" value="0" {{coverimages[0]}}>
                                <label class="custom-contrl-label" for="coverimage_none">
                                    Ei tietoa
                                </label>
                            </div>
                            <div class="custom-control custom-radio">
                                <input type="radio" name="coverimage" class="custon-control-input form-item"
                                    id="coverimage_no" value="1" {{coverimages[1]}}>
                                <label class="custom-contrl-label" for="coverimage_no">
                                    Ei
                                </label>
                            </div>
                            <div class="custom-control custom-radio">
                                <input type="radio" name="coverimage" class="custon-control-input form-item"
                                    id="coverimage_yes" value="2" {{coverimages[2]}}>
                                <label class="custom-contrl-label" for="coverimage_yes">
                                    Kyllä
                                </label>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    <div class="row view-field">
                        <div class="col view-field">
                            {% if edition.dustcover %}
                            Ylivetokannet.
                            {% endif %}
                            {% if edition.coverimage %}
                            Kuvakannet.
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <!-- Cover artist -->
            <div class="row">
                <div class="col">

                </div>
            </div>
            <!-- Artists -->
            <div class="row">
                <div class="col">

                </div>
            </div>
        </div>
    </div>
    <div class="accordion" id="editionCard">
        {% if stories|length %}
        <div class="card">
            <div class="card-header" id="headStories">
                <h2 class="mb-0">
                    <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse"
                        data-target="#stories" aria-expanded="false" aria-controls="stories">
                        Novellit
                    </button>
                </h2>
            </div>
            <div id="stories" class="collapse" aria-labelledby="headStories" data-parent="#editionCard">
                <div class="card-body">
                    {% if stories|length %}
                    <ul class="list-group list-group-flush">
                        {% for story in stories %}
                        <li class="list-group-item">
                            {% if story.creator_str != edition.work[0].creator_str %}
                            <b><span class="person-list">{{ story.creator_str }}</span></b>: {% endif %}
                            <a href=" {{ url_for('story', id=story.id) }}">{{ story.title }}</a>
                            {% if story.orig_title != story.title %}
                            ({{ story.orig_title}}
                            {%- if story.pubyear %}, {{story.pubyear}}{% endif %}) {% elif
                            story.pubyear %} ({{ story.pubyear}}) {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}
        {% if current_user.is_admin %}
        <div class="row">
            <div class="col edit-field">
                <label for="imported_string">Lähde</label>
                <input field="text" class="form-control form-item" id="imported_string" name="imported_string"
                    value="{{edition.imported_string}}" form="itemForm">
            </div>
        </div>
        <br>
        <input type="checkbox" id="edit_form" name="edit_form">
        <label for="edit_form">Muokkaa</label>
        {% endif %}

    </div>

    </div>
    </div>
    {% if current_user.is_admin %}
</form>
{% endif %}
{% block script %}
<script src="/static/js/personlink.js" type="text/javascript"></script>
<script type="text/javascript">
    var itemId = '{{edition.id}}'
</script>
<script src="/static/js/forms.js" type="text/javascript"></script>
{% endblock %}
{% endblock %}