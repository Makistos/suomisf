{% extends "base.html" %}
{% block content %}
{% from 'macros.html' import auto_complete %}
<div class="container">
    <div class="card border-primary mb-3" style="margin: 1rem auto;">
        {% if edition.work.authors|length %}
        <div class="card-header">
            {% for author in edition.work.authors %}
            <a href=" {{ url_for('person', personid=author.id) }}"> {{ author.alt_name }}</a>
            {% endfor %}
        </div>
        {% endif %}
        <div class="card-body">
            <h3 class="card-title">
                {{ edition.title}}
                {% if current_user.is_admin %} ({{ edition.id }}){% endif %}
            </h3>
            {% for work in works %}
            <a href=" {{ url_for('work', workid=work.id) }}">{{ work.orig_title }}</a>
            {%- if work.pubyear -%}, {{ work.pubyear }} {% endif %}<br>
            {% endfor %}
        </div>
        <ul class="list-group list-group-flush">
            <li class="list-group-item">
                <b>Julkaisuvuosi:</b> {{ edition.pubyear }}
            </li>
            <li class="list-group-item">
                <b>Painos:</b> {{ edition.editionnum }}
            </li>
            {% if edition.version %}
            <li class="list-group-item">
                <b>Laitos:</b> {{ edition.version }}
            </li>
            {% endif %}
            <li class="list-group-item">
                <b>Julkaisija:</b> <a
                    href=" {{ url_for('publisher', pubid=edition.publisher.id) }}">{{ edition.publisher.name }}</a>
            </li>
            {% if editors|length %}
            <li class="list-group-item">
                <b>Toimittaja(t):</b>
                {% if editors|length == 1 %}
                <a href=" {{ url_for('person', personid=editors[0].id) }}">{{
                    editors[0].alt_name }}</a>
                {% endif %}
                {% if editors|length == 2 %}
                <a href=" {{ url_for('person', personid=editors[0].id) }}">{{
                    editors[0].alt_name }}</a> ja
                <a href=" {{ url_for('person', personid=editors[1].id) }}">{{
                    editors[1].alt_name }}</a>

                {% endif %}
                {% if editors|length > 2 %}
                {% for editor in editors[:-1] %}
                <a href=" {{ url_for('person', personid=editor.id) }}">{{
                    editor.alt_name }}</a>,
                {% endfor %}
                <a href=" {{ url_for('person', personid=editors[-1].id) }}">{{
                editors[-1].alt_name }}</a>
                {% endif %}
                {% endif %}
            </li>
            {% if translators|length %}
            <li class="list-group-item">
                <b>Kääntäjä(t):</b>
                {% if translators|length == 1 %}
                <a href=" {{ url_for('person', personid=translators[0].id) }}">{{
                            translators[0].alt_name }}</a>
                {% endif %}
                {% if translators|length == 2 %}
                <a href=" {{ url_for('person', personid=translators[0].id) }}">{{
                            translators[0].alt_name }}</a> ja
                <a href=" {{ url_for('person', personid=translators[1].id) }}">{{
                            translators[1].alt_name }}</a>
                {% endif %}
                {% if translators|length > 2 %}
                {% for translator in translators[:-1] %}
                <a href=" {{ url_for('person', personid=translator.id) }}">{{
                            translator.alt_name }}</a>,
                {% endfor %}
                <a href=" {{ url_for('person', personid=translators[-1].id) }}">{{
                        translators[-1].alt_name }}</a>
                {% endif %}
            </li>
            {% endif %}
            {% set work = works[0] %}
            {% if work.bookseries %}
            <li class="list-group-item">
                <b>Kirjasarja:</b> <a href=" {{ url_for('bookseries',
			seriesid=work.bookseries.id) }} ">
                    {{ work.bookseries.name }}</a>
                {%- if work.bookseriesnum -%}
                {%- if work.bookseriesnum|length -%}
                , numero {{ work.bookseriesnum }}
                {% endif %}
                {% endif %}
            </li>
            {% endif %}
            {% if edition.pubseries.name|length %}
            <li class="list-group-item">
                <b>Julkaisijan sarja:</b> <a href=" {{ url_for('pubseries',
                    seriesid=edition.pubseries.id) }} ">{{
                    edition.pubseries.name }}</a>
            </li>
            {%- endif %}
            {% if edition.misc|length %}
            <li class="list-group-item">
                <b>Muuta:</b> {{ edition.misc }}
            </li>
            {% endif %}
        </ul>
        <div class="accordion" id="editionCard">
            {% if stories|length %}
            <div class="card">
                <div class="card-header" id="headStories">
                    <h2 class="mb-0">
                        <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse"
                            data-target="#stories" aria-expanded="false" aria-controls="stories">
                            Novellit
                        </button>
                    </h2>
                </div>
                <div id="stories" class="collapse" aria-labelledby="headStories" data-parent="#editionCard">
                    <div class="card-body">
                        {% if stories|length %}
                        <ul class="list-group list-group-flush">
                            {% for story in stories %}
                            <li class="list-group-item">
                                {% if story.creator_str != edition.work.creator_str %}
                                <b><span class="person-list">{{ story.creator_str }}</span></b>: {% endif %}
                                <a href=" {{ url_for('story', id=story.id) }}">{{ story.title }}</a>
                                {% if story.orig_title != story.title %}({{ story.orig_title}}
                                {%- if story.pubyear %}, {{story.pubyear}}{% endif %}) {% elif
                story.pubyear %} ({{ story.pubyear}}) {% endif %}
                            </li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}
            {% if current_user.is_admin %}
            <div class="card">
                <div class="card-header" id="headAdmin">
                    <h2 class="mb-0">
                        <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse"
                            data-target="#admin" aria-expanded="false" aria-controls="admin">
                            Ylläpito ({{edition.id}})
                        </button>
                    </h2>
                </div>
                <div id="admin" class="collapse" aria-labelledby="headAdmin" data-parent="#editionCard">
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            {% if edition.imported_string|length %}
                            <li class="list-group-item"><b>Lähde:</b>
                                {{edition.imported_string}}</li>
                            {% endif %}
                            <li class="list-group-item"><a href="{{url_for('edit_edition',
						editionid=edition.id)}}">Muokkaa</a></li>
                            <li class="list-group-item"><button type="button" class="btn btn-primary"
                                    data-toggle="modal" data-target="#editTranslators">
                                    Lisää/poista kääntäjiä</li>
                            </button>
                            <li class="list-group-item"><button type="button" class="btn btn-primary"
                                    data-toggle="modal" data-target="#editEditors">
                                    Lisää/poista toimittajia</li>
                            </button>
                        </ul>

                    </div>
                </div>
            </div>
            {% endif %}

        </div>
    </div>

    <!--- Model windows-->

    {% if current_user.is_admin %}
    <div class="modal fade" id="editTranslators" tabindex="-1" role="dialog" aria-labelledby="editTranslatorsLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editTranslatorsLabel">Muokkka kääntäjätietoja</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Sulje">
                        <span aria-hidden="true">&times</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="container-fluid">
                        {% for translator in edition.translators %}
                        <div class="row">
                            <div class="col-md-8">{{ translator.name }}</div>
                            <div class="col-md-4">
                                <a href="{{ url_for('remove_translator_from_work',
                                    editionid=edition.id, translatorid=translator.id)}}">Poista</a><br />
                            </div>
                        </div>
                        {% endfor %}
                        <hr>
                        <form action="" method="post">
                            <div class="form-row">
                                <div class="col-md-8">
                                    {{ form_translator.hidden_tag() }}
                                    {{ form_translator.translator(id="translator") }}
                                </div>
                                <div class="col-md-4">
                                    {{ form_translator.submit }}
                                </div>
                            </div>
                        </form>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Sulje</button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editEditors" tabindex="-1" role="dialog" aria-labelledby="editEditorsLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editEditorsLabel">Muokkka toimittajatietoja</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Sulje">
                        <span aria-hidden="true">&times</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="container-fluid">
                        {% for editor in edition.editors %}
                        <div class="row">
                            <div class="col-md-8">{{ editor.name }}</div>
                            <div class="col-md-4">
                                <a href="{{ url_for('remove_editor_from_work',
                                    editionid=edition.id, editorid=editor.id)}}">Poista</a><br />
                            </div>
                        </div>
                        {% endfor %}
                        <hr>
                        <form action="" method="post">
                            <div class="form-row">
                                <div class="col-md-8">
                                    {{ form_editor.hidden_tag() }}
                                    {{ form_editor.editor(id="editor") }}
                                </div>
                                <div class="col-md-4">
                                    {{ form_editor.submit }}
                                </div>
                            </div>
                        </form>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Sulje</button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{{ auto_complete("translator", "/autocomp_person")}}
{{ auto_complete("editor", "/autocomp_person")}}
{% block script %}
<script src="/static/js/personlink.js" type="text/javascript"></script>
{% endblock %}
{% endblock %}