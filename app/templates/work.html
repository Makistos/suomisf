{% extends "base.html" %}
{% block content %}
{% if current_user.is_admin %}
<form method="post" id="itemForm" class="align-items-center px-1 gx-1 gy-1">
    {{ form.hidden_tag() }}
    {% endif %}

    <div class="container">
        <div class="card border-primary mb-3">
            <div class="card-header">
                {% if current_user.is_admin %}
                <div class="edit-field">
                    <select class="author-selector form-control" multiple="multiple" data-placeholder="Kirjoittajat"
                        data-search="/select_person" data-save="/save_authors_to_work" data-init="/authors_for_work"
                        data-name="authors"></select>
                </div>
                {% endif %}
                <div class="view-field">
                    <span class="person-list">{{ work.creator_str }}</span>
                </div>
            </div>
            <div class="card-body mb-3">
                <div class="row align-items-start">
                    <div class="col-lg-8 col-sm-12">
                        <!-- Title -->
                        <div class="row">
                            <div class="col">
                                <h1 class="card-title">
                                    {% if current_user.is_admin %}
                                    <div class="edit-field">
                                        <input field="text" class="form-control form-item" value="{{work.title}}">
                                    </div>
                                    {% endif %}
                                    <div class="view-field">
                                        <h1 class="card-title">{{work.title}}</h1>
                                    </div>
                                </h1>
                            </div>
                        </div>
                        <!-- Subtitle -->
                        <div class="row">
                            <div class="col">
                                {% if current_user.is_admin %}
                                {% if work.subtitle %}
                                {% set subtitle = work.subtitle %}
                                {% else %}
                                {% set subtitle = '' %}
                                {% endif %}
                                <div class="edit-field">
                                    <label for="subtitle">
                                        Alaotsikko
                                        <input type="text" class="form-control form-item" value="{{subtitle}}">
                                    </label>
                                </div>
                                {% endif %}
                                <div class="view-field">
                                    {% if work.subtitle %}
                                    {{work.subtitle}}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <!-- Original name, year, language-->
                        <div class="row">
                            {% if current_user.is_admin %}
                            <div class="col-lg-4 edit-field">
                                <!-- Original title-->
                                <label for="orig-title">
                                    Alkup. nimi
                                    <input type="text" class="form-control form-item" id="orig_title" name="orig_title"
                                        value="{{work.orig_title}}">
                                </label>
                            </div>
                            <!-- Pubyear -->
                            <div class="col-lg-1 edit-field">
                                <label for="pubyear">
                                    Vuosi
                                    <input type="text" class="form-control form-item" id="pubyear" name="pubyear"
                                        value="{{work.pubyear}}">
                                </label>
                            </div>
                            <!-- Language -->
                            <div class="col-lg-3 edit-field">
                                <label for="language">
                                    Kieli
                                    <input type="text" class="form-control form-item" id="language" name="langueage"
                                        value="{{work.language}}">
                                </label>
                            </div>
                            {% endif %}
                            <div class="col view-field">
                                <i>
                                    {% if work.title != work.orig_title %} {{ work.orig_title }}
                                    {%- if work.pubyear -%} , {% endif %}
                                    {% endif %}
                                    {%- if work.pubyear -%}
                                    {{ work.pubyear }}
                                    {% endif %}
                                    {% if work.language %}
                                    ({{work.language}}))
                                    {% endif %}
                                </i>
                            </div>
                        </div>
                        <!-- Type -->
                        <div class="row">
                            {% if current_user.is_admin %}
                            <div class="col-lg-8">
                                <div class="edit-field">
                                    <div class="field form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="type" id="type" value="1">
                                        <label class="form-check-label" for="type">Romaani</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="type" id="type" value="2">
                                        <label class="form-check-label" for="type">Kokoelma</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="type" id="type" value="3">
                                        <label class="form-check-label" for="type">Sarjakuva</label>
                                    </div>
                                </div>
                                {% endif %}
                                <div class="view-field">
                                    {% if work.type %}
                                    {{work.type.name}}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <!-- Series, number, order -->
                        <div class="row">
                            {% if current_user.is_admin %}
                            <div class="col-lg-4 edit-field">
                                <select class="bookseries-selector form-control" data-placeholder="Kirjasarja"
                                    data-search="/select_bookseries" data-save="/save_bookseries_to_work"
                                    data-init="/bookseries_for_work" data-name="bookseries"></select>
                            </div>
                            <div class="col-lg-2 edit-field">
                                <label for="bookseriesnum">
                                    Numero
                                    <input type="text" class="form-control form-item" id="bookseriesnum"
                                        name="bookseriesnum" value="{{work.bookseriesnum}}">
                                </label>
                            </div>
                            <div class="col-lg-2 edit-field">
                                <label for="bookseriesorder">
                                    Järjestysnro
                                    <input type="text" class="form-control form-item" id="bookseriesorder"
                                        name="bookseriesorder" value="{{work.bookseriesnum}}">
                                </label>
                            </div>
                            {% endif %}
                            <div class="col view-field">
                                <a href=" {{ url_for('bookseries',
                                          seriesid=work.bookseries.id) }} ">
                                    {{ work.bookseries.name }}</a>
                                {%- if work.bookseriesnum %}
                                {% if work.bookseriesnum|length -%}, numero {{ work.bookseriesnum }}
                                {% if prev_book %}
                                <a href="{{url_for('work',
                                        workid=prev_book.id)}}">
                                    <img src="/static/icons/Arrows-Left-icon.png" alt="Edellinen" /></a>

                                {% endif %}
                                {% if next_book %}
                                <a href="{{url_for('work',
                                                           workid=next_book.id)}}">
                                    <img src="/static/icons/Arrows-Right-icon.png" alt="Seuraava" /></a>
                                {% endif %}
                                {% endif %}
                                {% endif %}
                            </div>
                        </div>
                        <!-- Tags -->
                        <div class="row">
                            {% if current_user.is_admin %}
                            <div class="col-lg-8 edit-field">
                                <select class="tag-selector form-control" multiple="multiple"
                                    data-placeholder="Asiasanat" data-search="/select_tag"
                                    data-save="/save_tags_to_work" data-init="/tags_for_work" data-name="tags" id="tags"
                                    data-tags="true"></select>
                            </div>
                            {% endif %}
                            <div class="col-lg-8 view-field">
                                {% for tag in work.tags %}
                                <a href="{{url_for('tag', tagid=tag.id)}}">{{tag.name}}</a>
                                {% endfor %}
                            </div>
                        </div>
                        <!-- Misc -->
                        <div class="row">
                            <div class="col">
                                {% if work.misc %}
                                {{work.misc}}
                                {% endif %}
                            </div>
                        </div>
                        <div class="row">
                            <div class="col edit-field">
                                <textarea class="form-control form-item" id="description" name="description" rows="5"
                                    cols="40" value="{{work.description}}"></textarea>
                            </div>
                            <div class="col view-field">
                                {% if work.description %}
                                {{work.description}}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <!-- Image -->
                    <div class="col-lg-4 col-sm-12 mx-auto">
                        <div class="row">
                            <div class="col">
                                {% if work.image_src %}
                                <img src="{{work.image_src}}" class="img-fluid">
                                {% endif %}
                            </div>
                        </div>
                        <div class="row">
                            <div class="col edit-field mx-auto">
                                {% if current_user.is_admin %}
                                <select class="genre-selector form-control" multiple="multiple"
                                    data-placeholder="Genret" data_search="/select_genre"
                                    data-save="/save_genres_to_work" data-init="/genres_for_work" data-name="genres"
                                    id="genres"></select>
                                {% endif %}
                            </div>
                            <div class="col view-field mx-auto">
                                {% for genre in work.genres %}
                                <li class="list-inline-item" style="padding-bottom: 1rem">
                                    <img src="/static/icons/{{genre.abbr}}_32.png" />
                                </li>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {#
        <div class="container">
            <div class="card border-primary mb-3" style="margin: 1rem auto">
                <div class="card-header">
                    {% if current_user.is_admin %}
                    <div class="edit-field">
                        <select class="author-selector form-control" multiple="multiple" data-placeholder="Kirjoittajat"
                            data-search="/select_person" data-save="/save_authors_to_work" data-init="/authors_for_work"
                            data-name="authors"></select>
                    </div>
                    {% endif %}
                    <div class="view-field">
                        <span class="person-list">{{ work.creator_str }}</span>
                    </div>
                </div>
                <div class="row justify-content-md-center no-gutters">
                    <div class="col col-lg-8">
                        <div class="card-body">
                            <h3 class="card-title">
                                {% if current_user.is_admin %}
                                <div class="edit-field">
                                    <input type="text" class="form-control form-item" id="title" name="title"
                                        value="{{work.title}}" form="itemForm">
                                </div>
                                {% endif %}
                                <div class="view-field">
                                    {{ work.title }}
                                </div>
                            </h3>
                            {% if current_user.is_admin %}
                            <div class="edit-field">
                                <label for="orig_title">
                                    Alkup. nimi
                                    <input type="text" class="form-control form-item" id="orig_title" name="orig_title"
                                        value="{{work.orig_title}}" form="itemForm">
                                </label>
                                <label for="pubyear">
                                    Vuosi
                                    <input type="text" class="form-control form-item" id="pubyear" name="pubyear"
                                        value="{{work.pubyear}}" form="itemForm">
                                </label>
                                <label for="language">
                                    Kieli
                                    <input type="text" class="form-control form-item" id="language" name="language"
                                        value="{{work.language}}" form="itemForm">
                                </label>
                            </div>
                            {% endif %}
                            <div class="view-field">
                                <i>
                                    {% if work.title != work.orig_title %} {{ work.orig_title }}
                                    {%- if work.pubyear -%} , {% endif %}
                                    {% endif %}
                                    {%- if work.pubyear -%}
                                    {{ work.pubyear }}
                                    {% endif %}
                                </i>
                            </div>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">
                                    {% if work.collection == true %}
                                    Kokoelma
                                    {% else %}
                                    Romaani
                                    {% endif %}
                                </li>
                            </ul>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">
                                    {% if current_user.is_admin %}
                                    <div class="edit-field">
                                        <select class="form-control" data-placeholder="Kirjasarja"
                                            data-search="/select_bookseries" data-save="/save_bookseries_to_work"
                                            data-init="/bookseries_for_work" data-name="bookseries"
                                            id="bookseries"></select>
                                        <label for="bookseriesnum">
                                            Numero
                                            <input type="text" class="form-control form-item"
                                                value="{{work.bookseriesnum}}" name="bookseriesnum" id="bookseriesnum">
                                        </label>
                                        <label for="bookseriesorder">
                                            Järjestysnumero
                                            <input type="text" class="form-control form-item"
                                                value="{{work.bookseriesorder}}" name="bookseriesorder"
                                                id="bookseriesorder">
                                        </label>
                                    </div>
                                    {% endif %}
                                    <div class="view-field">
                                        <a href=" {{ url_for('bookseries',
                                          seriesid=work.bookseries.id) }} ">
                                            {{ work.bookseries.name }}</a>
                                        {%- if work.bookseriesnum %}
                                        {% if work.bookseriesnum|length -%}, numero {{ work.bookseriesnum }}
                                        {% if prev_book %}
                                        <a href="{{url_for('work',
                                        workid=prev_book.id)}}">
                                            <img src="/static/icons/Arrows-Left-icon.png" alt="Edellinen" /></a>

                                        {% endif %}
                                        {% if next_book %}
                                        <a href="{{url_for('work',
                            workid=next_book.id)}}"><img src="/static/icons/Arrows-Right-icon.png"
                                                alt="Seuraava" /></a>
                                        {% endif %}
                                        {% endif %}
                                    </div>
                                    {% endif %}
                                </li>
                                {% if current_user.is_admin %}
                                <div class="edit-field">
                                    <label for="misc">
                                        Muuta
                                        <input type="text" class="form-control form-item" value="{{work.misc}}"
                                            name="misc" id="misc">
                                    </label>
                                </div>
                                {% endif %}
                                {% if work.misc %}
                                <div class="view-field">
                                    <li class="list-group-item">{{ work.misc }}</li>
                                </div>
                                {% endif %}
                            </ul>
                        </div>
                    </div>
                    <div class="col container col-lg-4 justify-content-end justify-content-center align-middle">
                        <div class="row">
                            <div id="coverCarousel" class="carossel slide" data-ride="carousel">
                                <div class="carousel-inner">
                                    <div class="carousel-item active">
                                        <img class="d-block w-100" src="{{work.editions[0].image_src}}" />
                                        {% if work.editions[1] %}
                                        <div class="carousel-caption">
                                            <h5>{{work.editions[0].editionnum}}. painos</h5>
                                        </div>
                                        {% endif %}
                                    </div>
                                    {% if work.editions[1] %}
                                    {% for edition in work.editions[1:] %}
                                    <div class="carousel-item">
                                        <img class="d-block w-100" src="{{edition.image_src}}" />
                                        <div class="carousel-caption">
                                            <p>{{edition.editionnum}}. painos</p>
                                            {% if edition.version %}
                                            <br />{{edition.version}}. laitos
                                            {%endif %}
                                        </div>
                                    </div>
                                    {%endfor %}
                                    {% endif %}
                                </div>
                                {% if work.editions[1] %}
                                <a class="carousel-control-prev" href="#coverCarousel" rold="button" data-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    <span class="sr-only">Previous</span>
                                </a>
                                <a class="carousel-control-next" href="#coverCarousel" rold="button" data-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    <span class="sr-only">Next</span>
                                </a>
                                {% endif %}
                            </div>
                        </div>
                        <div class="row align-middle justify-content-center">
                            <ul class="list-inline" style="padding: 1rem; text-align: center">
                                {% for genre in work.genres %}
                                {#
                                <li class="list-inline-item" style="
                margin-bottom: 3px;
                line-height: 1rem;
                padding-bottom: 1rem;
              ">
                                    <h1 style="font-family: 'Raleway', sans-serif">
                                        <b>{{genre.genre_name}}</b>
                                    </h1>
                                </li>
                                <li class="list-inline-item" style="padding-bottom: 1rem">
                                    <img src="/static/icons/{{genre.abbr}}_32.png" />
                                </li>
                                {% endfor %}
                                {% for tag in work.tags %}
                                <a href="{{url_for('tag', tagid=tag.id)}}">{{tag.name}}</a>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
                #}
                <div class="accordion" id="workCard">
                    {% if stories|length %}
                    <div class="card">
                        <div class="card-header" id="headStories">
                            <h2 class="mb-0">
                                <button class="btn btn-link btn-block text-left collapsed" type="button"
                                    data-toggle="collapse" data-target="#stories" aria-expanded="false"
                                    aria-controls="stories">
                                    Novellit
                                </button>
                            </h2>
                        </div>
                        <div id="stories" class="collapse" aria-labelledby="headStories" data-parent="#workCard">
                            <div class="card-body">
                                {% if stories|length %}
                                <ul class="list-group list-group-flush">
                                    {% for story in stories %}
                                    <li class="list-group-item">
                                        {% if story.creator_str != work.creator_str %}
                                        <b><span class="person-list">{{ story.creator_str }}</span></b>: {%
                                        endif %}
                                        <a href=" {{ url_for('story', id=story.id) }}">{{ story.title }}</a>
                                        {% if story.orig_title != story.title %}({{ story.orig_title}}
                                        {%- if story.pubyear %}, {{story.pubyear}}{% endif %}) {% elif
                                        story.pubyear %} ({{ story.pubyear}}) {% endif %}
                                    </li>
                                    {% endfor %}
                                </ul>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    <div class="card">
                        <div class="card-header" id="headEditions">
                            <h2 class="mb-0">
                                <button class="btn btn-link btn-block text-left collapsed" type="button"
                                    data-toggle="collapse" data-target="#editions" aria-expanded="false"
                                    aria-controls="editions">
                                    Painokset
                                </button>
                            </h2>
                        </div>
                        <div id="editions" aria-labelledby="headEditions" data-parent="#workCard">
                            <div class="card-body">
                                <ul class="list-group list-group-flush">
                                    {% for edition in work.editions %}
                                    <li class="list-group-item">
                                        <a href=" {{ url_for('edition', editionid=edition.id) }}">{{
                                            edition.title
                                            }}</a>.
                                        {%- if edition.translators %} {% include
                                        "_translators.html"-%}{%- endif %} {{ edition.publisher.name }}
                                        {{ edition.pubyear}}. {% if edition.pubseries.name|length %} {{
                                        edition.pubseries.name }} {%- if edition.pubseriesnum %}
                                        {{edition.pubseriesnum }}{% endif %}. {% endif %}
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                    {% if current_user.is_admin %}
                    <div class="card">
                        <div class="card-header" id="headAdmin">
                            <h2 class="mb-0">
                                <button class="btn btn-link btn-block text-left collapsed" type="button"
                                    data-toggle="collapse" data-target="#admin" aria-expanded="false"
                                    aria-controls="admin">
                                    Ylläpito ({{work.id}})
                                </button>
                            </h2>
                        </div>
                        <div id="admin" class="collapse" aria-labelledby="headAdmin" data-parent="#workCard">
                            <div class="card-body">
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item">
                                        <b>Lähde: </b>{{work.imported_string}}
                                    </li>
                                    <li class="list-group-item">
                                        <a href=" {{ url_for('edit_work', workid=work.id) }}">Muokkaa</a>
                                    </li>
                                    <li class="list-group-item">
                                        <a href=" {{ url_for('add_edition', workid=work.id) }}">Lisää painos</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            <input type="checkbox" id="edit_form" name="edit_form">
            <label for="edit_form">Muokkaa</label>
            {% if current_user.is_admin %}
        </div>
</form>
{% endif %}
{% block script %}
<script src="/static/js/personlink.js" type="text/javascript"></script>
<script type="text/javascript">
    var itemId = '{{work.id}}'
</script>
<script src="/static/js/forms.js" type="text/javascript"></script>
{% endblock %}
{% endblock %}