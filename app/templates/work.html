{% extends "base.html" %}

{% block content %}
<div class="container">
<div class="accordion" id="workCard">
<div class="card border-primary mb-3" style="width: 720px;">
        <div class="card-header">
            {{ work.title }}
            {% if current_user.is_admin %}
                ({{ work.id }})
            {% endif %}
        </div>
        <div class="card-body">
            <h5 class="card-title"><span class="person-list">{{ work.creator_str }}</span></h5>
        </div>
        <div class="card-body">
            <ul class="list-group list-group-flush">
            <li class="list-group-item"><b>Julkaisuvuosi:</b> {{ work.pubyear }}</li>
            {% if work.bookseries.name|length %}
            <li class="list-group-item"><b>Kirjasarja:</b> <a href=" {{ url_for('bookseries',
                                    seriesid=work.bookseries.id) }} ">{{
                                    work.bookseries.name }}</a>
                    {% if work.bookseriesnum %}
                            {% if work.bookseriesnum|length %}
                            , numero {{ work.bookseriesnum }}</li>
                            {% endif %}
                    {% endif %}
            {%- endif %}
            <li class="list-group-item"><b>Genre:</b> {{ work.genres|join(', ', attribute='genre_name') }}</li>
            {% if work.misc %}
            <li class="list-group-item"><b>Muuta:</b> {{ work.misc }}</li>
            {% endif %}
        </ul>
        </div>
        <div class="card">
            <div class="card-header" id="headStories">
                <h2 class="mb-0">
                    <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse"
                            data-target="#stories" aria-expanded="false" aria-controls="stories">
                        Novellit
                    </button>
                </h2>
            </div>
            <div id="stories"  class="collapse" aria-labelledby="headStories" data-parent="#workCard">
                <div class="card-body">
                {% if stories|length %}
                <ul class="list-group list-group-flush">
                    {% for story in stories %}
                    <li class="list-group-item">
                            {% if story.creator_str != work.creator_str %}
                            <b><span class="person-list">{{ story.creator_str }}</span></b>:
                            {% endif %}
                            <a href=" {{ url_for('story', id=story.id) }}">{{ story.title }}</a>
                        {% if story.orig_title != story.title %}({{ story.orig_title}}
                        {%- if story.pubyear %}, {{story.pubyear}}{% endif %})
                        {% elif story.pubyear %}
                        ({{ story.pubyear}})
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-header" id="headEditions">
                <h2 class="mb-0">
                    <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse"
                            data-target="#editions" aria-expanded="false" aria-controls="editions">
                        Painokset
                    </button>
                </h2>
            </div>
            <div id="editions" class="collapse" aria-labelledby="headEditions" data-parent="#workCard">
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                    {% for edition in work.editions %}
                    <li class="list-group-item"><a href=" {{ url_for('edition', editionid=edition.id) }}">{{ edition.title
                            }}</a>.{%- if edition.translators %} {% include
                        "_translators.html" -%}{%- endif %} {{ edition.publisher.name }} {{ edition.pubyear }}.
                    {% if edition.pubseries.name|length %}
                        {{ edition.pubseries.name }}
                        {%- if edition.pubseriesnum %} {{ edition.pubseriesnum }}{% endif %}.
                    {% endif %}
                            </li>
                    {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
</div>
    {% if current_user.is_admin %}
        <p>Aineiston lähde: {{ work.fullstring }}</p>
    {% endif %}
    {% if current_user.is_admin %}
        <hr>
        <p><a href=" {{ url_for('edit_work', workid=work.id) }} ">Muokkaa</a></p>
        <p><a href=" {{ url_for('add_edition', workid=work.id) }}">Lisää painos</a></p>
	<!-- Trigger/Open The Modal -->
	<button id="myBtn">Lisää/poista kirjailija</button>

	<!-- The Modal -->
	<div id="myModal" class="modal">

		<!-- Modal content -->
		<div class="modal-content">
			<div class="modal-header">
				<span class="close">&times;</span>
				<h2>Muokkaa kirjailijatietoja</h2>
			</div>
			<div class="modal-body">
				{% for author in authors %}
				{{ author.name }}
				<a href="{{ url_for('remove_author_from_work',
					 workid=work.id, authorid=author.id)}}">Poista</a><br>
				{% endfor %}
				<form action="" method=post>
					{{ form.hidden_tag() }}
					{{ form.author.label }}
					{{ form.author(size=100) }}
					{{ form.submit }}
				</form>
			</div>
				<div class="modal-footer">
					<h3></h3>
			</div>
		</div>

    {% endif %}
</div>
</div>
</div>
{% block script %}
<script src="/static/js/personlink.js" type="text/javascript"></script>
<script src="/static/js/author.js">
{% include "_searchable_lists.html" %}
</script>
{% endblock %}
{% endblock %}

