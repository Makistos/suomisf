{% extends "base.html" %}
{% block content %}
{% if current_user.is_admin %}
<form method="post" id="itemForm">
    {{ form.hidden_tag() }}
    {% endif %}

    <div class="container">
        <div class="card">
            <div class="card-header">
                {% if current_user.is_admin %}
                <div class="edit-field">
                    <select class="author-selector form-control" multiple="multiple" data-placeholder="Kirjoittajat"
                        data-search="/select_person" data-save="/save_authors_to_work" data-init="/authors_for_work"
                        data-name="authors"></select>
                </div>
                {% endif %}
                <div class="view-field">
                    <span class="person-list">{{ work.creator_str }}</span>
                </div>
            </div>
            <div class="card-body mb-3">
                <div class="row align-items-start">
                    <div class="col-lg-8 col-sm-12">
                        <!-- Title -->
                        <div class="row">
                            <div class="col">
                                <h1 class="card-title">
                                    {% if current_user.is_admin %}
                                    <div class="edit-field">
                                        <input type="text" class="form-control form-item" value="{{work.title}}"
                                            form="itemForm" id="title" name="title">
                                    </div>
                                    {% endif %}
                                    <div class="view-field">
                                        <h1 class="underline card-title">{{work.title}}</h1>
                                    </div>
                                </h1>
                            </div>
                        </div>
                        <!-- Subtitle -->
                        <div class="row">
                            <div class="col">
                                {% if current_user.is_admin %}
                                <div class="edit-field">
                                    <label for="subtitle">Alaotsikko</label>
                                    <input type="text" class="form-control form-item"
                                        value="{{work.subtitle if work.subtitle is not none}}" form="itemForm"
                                        id="subtitle" name="subtitle">
                                </div>
                                {% endif %}
                                <div class="view-field">
                                    {% if work.subtitle %}
                                    {{work.subtitle}}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <!-- Original name, year, language-->
                        <div class="row">
                            {% if current_user.is_admin %}
                            <div class="col-lg-7 edit-field">
                                <!-- Original title-->
                                <label for="orig-title">Alkup. nimi</label>
                                <input type="text" class="form-control form-item" id="orig_title" name="orig_title"
                                    value="{{work.orig_title if work.orig_title is not none}}">
                            </div>
                            <!-- Pubyear -->
                            <div class="col-lg-2 edit-field">
                                <label for="pubyear">Vuosi</label>
                                <input type="text" class="form-control form-item" id="pubyear" name="pubyear"
                                    value="{{work.pubyear if work.pubyear is not none}}">
                            </div>
                            <!-- Language -->
                            <div class="col-lg-3 edit-field">
                                <label for="language">Kieli</label>
                                <select class="language-selector form-control" data-placeholder="Alkup. kieli"
                                    data-search="/select_language" data-save="/save_language_to_work"
                                    data-init="/language_for_work" data-name="language" id="language" data-tags="true"
                                    name="language"></select>
                            </div>
                            {% endif %}
                            <div class="col view-field">
                                <i>
                                    {% if work.title != work.orig_title %} {{ work.orig_title }}
                                    {%- if work.pubyear -%} , {% endif %}
                                    {% endif %}
                                    {%- if work.pubyear -%}
                                    {{ work.pubyear }}
                                    {% endif %}
                                    {% if work.language %}
                                    ({{work.language_name.name}})
                                    {% endif %}
                                </i>
                            </div>
                        </div>
                        <!-- Type -->
                        <div class="row mb-2 mt-2">
                            {% if current_user.is_admin %}
                            <div class="col-lg-12">
                                <div class="edit-field">
                                    <div class="field form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="type" id="type" value="1"
                                            {{types[1]}}>
                                        <label class="form-check-label" for="type">Romaani</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="type" id="type" value="2"
                                            {{types[2]}}>
                                        <label class="form-check-label" for="type">Kokoelma</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="type" id="type" value="3"
                                            {{types[3]}}>
                                        <label class="form-check-label" for="type">Sarjakuva</label>
                                    </div>
                                </div>
                                {% endif %}
                                <div class="view-field">
                                    {% if work.type %}
                                    {{work.type.name}}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <!-- Series, number, order -->
                        <div class="row">
                            {% if current_user.is_admin %}
                            <div class="col-lg-8 edit-field">
                                <label for="bookseries">Kirjasarja</label>
                                <select class="bookseries-selector form-control" data-placeholder="Kirjasarja"
                                    data-search="/select_bookseries" data-save="/save_bookseries_to_work"
                                    data-init="/bookseries_for_work" data-name="bookseries" id="bookseries"
                                    name="bookseries"></select>
                            </div>
                            <div class="col-lg-2 edit-field">
                                <label for="bookseriesnum">Numero</label>
                                <input type="text" class="form-control form-item" id="bookseriesnum"
                                    name="bookseriesnum"
                                    value="{{work.bookseriesnum if work.bookseriesnum is not none}}">
                            </div>
                            <div class="col-lg-2 edit-field">
                                <label for="bookseriesorder">Järjestysnro</label>
                                <input type="text" class="form-control form-item" id="bookseriesorder"
                                    name="bookseriesorder"
                                    value="{{work.bookseriesorder if work.bookseriesorder is not none and work.bookseriesorder != 0}}">
                            </div>
                            {% endif %}
                            <div class="col view-field">
                                <a href=" {{ url_for('bookseries',
                                          seriesid=work.bookseries.id) }} ">
                                    {{ work.bookseries.name }}</a>
                                {%- if work.bookseriesnum %}
                                {% if work.bookseriesnum|length -%}, numero {{ work.bookseriesnum }}
                                {% if prev_book %}
                                <a href="{{url_for('work',
                                        workid=prev_book.id)}}">
                                    <img src="/static/icons/Arrows-Left-icon.png" alt="Edellinen" /></a>

                                {% endif %}
                                {% if next_book %}
                                <a href="{{url_for('work',
                                                           workid=next_book.id)}}">
                                    <img src="/static/icons/Arrows-Right-icon.png" alt="Seuraava" /></a>
                                {% endif %}
                                {% endif %}
                                {% endif %}
                            </div>
                        </div>
                        <!-- Misc -->
                        <div class="row">
                            {% if current_user.is_admin %}
                            <div class="col-lg-12 align-self-start edit-field">
                                <label for="misc">
                                    Muuta
                                </label>
                                <input type="text" class="form-control form-item" id="misc" name="misc"
                                    value="{{work.misc if work.misc is not none}}">
                            </div>
                            {% endif %}
                            <div class="col-lg-12 align-self-start view-field">
                                {% if work.misc %}
                                {{work.misc}}
                                {% endif %}
                            </div>
                        </div>
                        <!-- Description -->
                        <div class="row">
                            <div class="col edit-field">
                                <label for="description">Kuvaus</label>
                                <textarea class="form-control form-item" id="description" name="description" rows="5"
                                    cols="40">{{work.description if work.description is not none}}</textarea>
                            </div>
                            <div class="col view-field">
                                {{work.description if work.description is not none}}
                            </div>
                        </div>
                    </div>
                    <!-- Genre and tags -->
                    <div class="col-lg-4 col-sm-12 mx-auto">
                        <div class="row">
                            <div class="col edit-field mx-auto">
                                {% if current_user.is_admin %}
                                <select class="genre-selector form-control" multiple="multiple"
                                    data-placeholder="Genret" data-search="/select_genre"
                                    data-save="/save_genres_to_work" data-init="/genres_for_work" data-name="genres"
                                    id="genres" data-mininput="1"></select>
                                {% endif %}
                            </div>
                            <div class="col view-field mx-auto">
                                {% for genre in work.genres %}
                                <li class="list-inline-item" style="padding-bottom: 1rem">
                                    <img src="/static/icons/{{genre.abbr}}_32.png" alt="{{genre.name}}" />
                                </li>
                                {% endfor %}
                            </div>
                        </div>
                        <!-- Tags -->
                        <div class="row m-3">
                            {% if current_user.is_admin %}
                            <div class="col-lg-12 edit-field">
                                <select class="tag-selector form-control" multiple="multiple"
                                    data-placeholder="Asiasanat" data-search="/select_tags"
                                    data-save="/save_tags_to_work" data-init="/tags_for_work" data-name="tags" id="tags"
                                    data-tags="true" name="tags"></select>
                            </div>
                            {% endif %}
                            <div class="col view-field">
                                {% for tag in work.tags %}
                                <a href="{{url_for('tag', tagid=tag.id)}}">{{tag.name}}</a>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Short stories -->
                {% if current_user.is_admin %}
                <div class="row">
                    <div class="col-lg-12 edit-field">
                        <label for="stories">Novellit</label>
                        <select class="story-selector form-control" multiple="multiple" data-placeholder="Novellit"
                            data-search="/select_story" data-save="/save_stories_to_work" data-init="/stories_for_work"
                            data-name="stories" id="stories" data-tags="true" name="stories"
                            data-separators="|"></select>
                    </div>
                </div>
                {% endif %}
                <div class="row">
                    <div class="col edit-field">
                        <a href="{{url_for('add_edition_to_route', workid=work.id)}}">Lisää painos</a>
                    </div>
                </div>
            </div>
            <div class="accordion" id="workCard">
                {% if work.stories|length %}
                <div class="card">
                    <div class="card-header" id="headStories">
                        <h2 class="mb-0">
                            <button class="btn btn-link btn-block text-left collapsed" type="button"
                                data-toggle="collapse" data-target="#stories" aria-expanded="false"
                                aria-controls="stories">
                                Novellit
                            </button>
                        </h2>
                    </div>
                    <div id="stories" class="collapse" aria-labelledby="headStories" data-parent="#workCard">
                        <div class="card-body">
                            {% if stories|length %}
                            <ul class="list-group list-group-flush">
                                {% for story in stories %}
                                <li class="list-group-item">
                                    {% if story.creator_str != work.creator_str %}
                                    <b><span class="person-list">{{ story.creator_str }}</span></b>: {%
                                    endif %}
                                    <a href=" {{ url_for('story', id=story.id) }}">{{ story.title }}</a>
                                    {% if story.orig_title != story.title %}({{ story.orig_title}}
                                    {%- if story.pubyear %}, {{story.pubyear}}{% endif %}) {% elif
                                    story.pubyear %} ({{ story.pubyear}}) {% endif %}
                                </li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endif %}
                <div class="card">
                    <div class="card-header" id="headEditions">
                        <h2 class="mb-0">
                            <button class="btn btn-link btn-block text-left collapsed" type="button"
                                data-toggle="collapse" data-target="#editions" aria-expanded="false"
                                aria-controls="editions">
                                Painokset
                            </button>
                        </h2>
                    </div>
                    <div id="editions" aria-labelledby="headEditions" data-parent="#workCard">
                        <div class="card-body">
                            <div class="mb-3">
                                <button onclick="switchStyle()" id="switcher" class="btn btn-light">Kannet</button>
                            </div>
                            <ul class="list-group list-group-flush" id="textual">
                                {% for edition in work.editions %}
                                <li class="list-group-item">
                                    <a href=" {{ url_for('edition', editionid=edition.id) }}">{{
                                        edition.title
                                        }}</a>.
                                    {%- if edition.translators %} {% include
                                    "_translators.html"-%}{%- endif %} {{ edition.publisher.name }}
                                    {{ edition.pubyear}}. {% if edition.pubseries.name|length %} {{
                                    edition.pubseries.name }} {%- if edition.pubseriesnum %}
                                    {{edition.pubseriesnum }}{% endif %}. {% endif %}
                                </li>
                                {% endfor %}
                            </ul>
                            <div id="pics">
                                {% for edition in work.editions %}
                                <div class="column">
                                    {% if edition.images|length %}
                                    <figure class="figure">
                                        <a href="{{url_for('edition', editionid=edition.id)}}">
                                            <img src="{{edition.images[0].image_src}}" width="250"
                                                style="margin: 0 1rem 1rem 0">
                                        </a>
                                    </figure>
                                    {% endif %}
                                </div>

                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
                {% if current_user.is_admin %}
                <div class="card">
                    <div class="card-header" id="headAdmin">
                        <h2 class="mb-0">
                            <button class="btn btn-link btn-block text-left collapsed" type="button"
                                data-toggle="collapse" data-target="#admin" aria-expanded="false" aria-controls="admin">
                                Ylläpito ({{work.id}})
                            </button>
                        </h2>
                    </div>
                    <div id="admin" class="collapse" aria-labelledby="headAdmin" data-parent="#workCard">
                        <div class="card-body">
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">
                                    <div class="row">
                                        <div class="col edit-field">
                                            <label for="imported_string">Lähde</label>
                                            <input field="text" class="form-control form-item" id="imported_string"
                                                name="imported_string" value="{{work.imported_string}}" form="itemForm">
                                        </div>
                                </li>
                                <li class="list-group-item">
                                    <a href=" {{ url_for('add_edition', workid=work.id) }}">Lisää painos</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        {% if current_user.is_admin %}
        <input type="checkbox" id="edit_form" name="edit_form">
        <label for="edit_form">Muokkaa</label>
        {% endif %}
    </div>
    </div>
    {% if current_user.is_admin %}
</form>
{% endif %}
{% block script %}
<script type="text/javascript">
    var itemId = '{{work.id}}'
</script>
<script src="/static/js/ownership.js"></script>
<script src="/static/js/custom-elements.js"></script>
<script src="/static/js/personlink.js" type="text/javascript"></script>
<script src="/static/js/forms.js" type="text/javascript"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById('pics').style.display = 'none';
    })
</script>
<script src="/static/js/contentSwitcher.js"></script>


{% endblock %}
{% endblock %}