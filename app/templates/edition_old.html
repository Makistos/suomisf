{% extends "base.html" %}
{% block content %}
{% from 'macros.html' import auto_complete %}
<div class="container mb-3">
    <div class="card border-primary mb-3">
        <div class="card-header">
            {% for w in edition.work %}
            {{ w.creator_str }}
            {% endfor %}
        </div>
        <div class="card-body">
            <h3 class="card-title">
                {% if current_user.is_admin %}
                <input type="text" class="form-control h3" onblur="saveEditionForm()"
                 id="title" value="{{edition.title}}" style="border:0;">
                {% else %}
                {{ edition.title}}
                {% endif %}
            </h3>
            {% for work in works %}
            <a href=" {{ url_for('work', workid=work.id) }}">{{ work.orig_title }}</a>
            {%- if work.pubyear -%}, {{ work.pubyear }} {% endif %}
            {% endfor %}
        <div class="row">
            <div class="col flex-grow-1">
                <div class="col">
                    <div class="row">
                        Julkaisuvuosi
                    </div>
                    <div class="row">
                        Painos
                    </div>
                    <div class="row">
                        Julkaisija
                    </div>
                </div>
                <div class="col">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item">
                        <b>Julkaisuvuosi:</b>
                        {% if current_user.is_admin %}
                                <input type="text" style="width: auto;"
                                 class="form-control"
                                 onblur="saveEditionForm()" id="pubyear"
                                 value="{{edition.pubyear}}">
                        {% else %}
                        {{ edition.pubyear }}
                        {%endif %}
                    </li>
                    <li class="list-group-item">
                        <b>Painos:</b> {{ edition.editionnum }}
                    </li>
                    {% if edition.version %}
                    <li class="list-group-item">
                        <b>Laitos:</b> {{ edition.version }}
                    </li>
                    {% endif %}
                    <li class="list-group-item">
                        <b>Julkaisija:</b> <a
                            href=" {{ url_for('publisher', pubid=edition.publisher.id) }}">{{ edition.publisher.name }}</a>
                    </li>
                    {% if editors|length %}
                    <li class="list-group-item">
                        <b>Toimittaja(t):</b>
                        {% if editors|length == 1 %}
                        <a href=" {{ url_for('person', personid=editors[0].id) }}">{{
                            editors[0].alt_name }}</a>
                        {% endif %}
                        {% if editors|length == 2 %}
                        <a href=" {{ url_for('person', personid=editors[0].id) }}">{{
                            editors[0].alt_name }}</a> ja
                        <a href=" {{ url_for('person', personid=editors[1].id) }}">{{
                            editors[1].alt_name }}</a>

                        {% endif %}
                        {% if editors|length > 2 %}
                        {% for editor in editors[:-1] %}
                        <a href=" {{ url_for('person', personid=editor.id) }}">{{
                            editor.alt_name }}</a>,
                        {% endfor %}
                        <a href=" {{ url_for('person', personid=editors[-1].id) }}">{{
                        editors[-1].alt_name }}</a>
                        {% endif %}
                    </li>
                    {% endif %}
                    {% if translators|length %}
                    <li class="list-group-item">
                        <b>Kääntäjä(t):</b>
                        {% if current_user.is_admin %}
                        <div class="edit-field">
                            <select class="form-control" multiple="multiple"
                                data-placeholder="Kääntäjät"
                                data-search="/select_person"
                                data-save="/save_translators_to_edition"
                                data-init="/translators_for_edition"
                                data-name="translators">
                            </select>
                        </div>
                        {% endif %}
                        <div class="view-field">
                            {% if translators|length == 1 %}
                            <a href=" {{ url_for('person', personid=translators[0].id) }}">{{
                                        translators[0].alt_name }}</a>
                            {% endif %}
                            {% if translators|length == 2 %}
                            <a href=" {{ url_for('person', personid=translators[0].id) }}">{{
                                        translators[0].alt_name }}</a> ja
                            <a href=" {{ url_for('person', personid=translators[1].id) }}">{{
                                        translators[1].alt_name }}</a>
                            {% endif %}
                            {% if translators|length > 2 %}
                            {% for translator in translators[:-1] %}
                            <a href=" {{ url_for('person', personid=translator.id) }}">{{
                                        translator.alt_name }}</a>,
                            {% endfor %}
                            <a href=" {{ url_for('person', personid=translators[-1].id) }}">{{
                                    translators[-1].alt_name }}</a>
                            {% endif %}
                        </div>
                    </li>
                    {% endif %}
                    {% set work = works[0] %}
                    {% if work.bookseries %}
                    <li class="list-group-item">
                        <b>Kirjasarja:</b> <a href=" {{ url_for('bookseries',
                    seriesid=work.bookseries.id) }} ">
                            {{ work.bookseries.name }}</a>
                        {%- if work.bookseriesnum -%}
                        {%- if work.bookseriesnum|length -%}
                        , numero {{ work.bookseriesnum }}
                        {% endif %}
                        {% endif %}
                    </li>
                    {% endif %}
                    {% if edition.pubseries.name|length %}
                    <li class="list-group-item">
                        <b>Julkaisijan sarja:</b> <a href=" {{ url_for('pubseries',
                            seriesid=edition.pubseries.id) }} ">{{
                            edition.pubseries.name }}</a>
                    </li>
                    {%- endif %}
                    {% if edition.misc|length %}
                    <li class="list-group-item">
                        <b>Muuta:</b> {{ edition.misc }}
                    </li>
                    {% endif %}
                </ul>
            </div>
            <div class="col col-md-4" style="margin: 1rem;">
                {% if edition.image_src %}
                    <img src="{{edition.image_src}}">
                {% endif %}
            </div>

        </div>
        </div>
        <div class="accordion" id="editionCard">
            {% if stories|length %}
            <div class="card">
                <div class="card-header" id="headStories">
                    <h2 class="mb-0">
                        <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse"
                            data-target="#stories" aria-expanded="false" aria-controls="stories">
                            Novellit
                        </button>
                    </h2>
                </div>
                <div id="stories" class="collapse" aria-labelledby="headStories" data-parent="#editionCard">
                    <div class="card-body">
                        {% if stories|length %}
                        <ul class="list-group list-group-flush">
                            {% for story in stories %}
                            <li class="list-group-item">
                                {% if story.creator_str != edition.work[0].creator_str %}
                                <b><span class="person-list">{{ story.creator_str }}</span></b>: {% endif %}
                                <a href=" {{ url_for('story', id=story.id) }}">{{ story.title }}</a>
                                {% if story.orig_title != story.title %}
                                ({{ story.orig_title}}
                                    {%- if story.pubyear %}, {{story.pubyear}}{% endif %}) {% elif
                story.pubyear %} ({{ story.pubyear}}) {% endif %}
                            </li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}
            {% if current_user.is_admin %}
            <div class="card">
                <div class="card-header" id="headAdmin">
                    <h2 class="mb-0">
                        <button class="btn btn-link btn-block text-left collapsed" type="button" data-toggle="collapse"
                            data-target="#admin" aria-expanded="false" aria-controls="admin">
                            Ylläpito ({{edition.id}})
                        </button>
                    </h2>
                </div>
                <div id="admin" class="collapse" aria-labelledby="headAdmin" data-parent="#editionCard">
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            {% if edition.imported_string|length %}
                            <li class="list-group-item"><b>Lähde:</b>
                                {{edition.imported_string}}</li>
                            {% endif %}
					<li class="list-group-item">
						<input type="checkbox" id="edit_form" name="edit_form">
						<label for="edit_form">Muokkaa</label>
					</li>

                        </ul>

                    </div>
                </div>
            </div>
            {% endif %}

        </div>
    </div>

</div>
{% block script %}
<script src="/static/js/personlink.js" type="text/javascript"></script>
<script type="text/javascript">
	var itemId = '{{edition.id}}'
</script>
<script src="/static/js/forms.js" type="text/javascript"></script>

{% endblock %}
{% endblock %}